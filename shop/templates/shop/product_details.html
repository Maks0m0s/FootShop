{% extends 'shop/base.html' %}

{% block content %}
<div class="product-detail" style="max-width:1000px;margin:40px auto;background:#2c2c2c;padding:40px;border-radius:16px;display:flex;flex-wrap:wrap;gap:40px;box-shadow:0 10px 20px rgba(0,0,0,0.3);">

    <!-- Product photo -->
    <div class="product-photo" style="flex:1; max-width:350px;">
        {% if product.photo %}
          <img src="{{ product.photo.url }}" alt="Product photo"
               style="width:100%; border-radius:16px; box-shadow:0 5px 15px rgba(0,0,0,0.3);">
        {% else %}
          <div style="width:100%; height:350px; background:#555; border-radius:16px; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:18px;">
            No Image
          </div>
        {% endif %}
    </div>

    <!-- Product info -->
    <div class="product-info" style="flex:2; color:#fff;">
        <h1 style="color:#ffcc00; font-size:36px; margin-bottom:20px; line-height:1.2;">
            {% if product.club %}{{ product.club }}{% endif %}
            {% if product.player %}- {{ product.player }}{% endif %}
            {% if product.name %}{{ product.name }}{% endif %}
            ({{ product.year }})
        </h1>

        {% if product.brand %}
          <p><strong>Brand:</strong> {{ product.brand }}</p>
        {% endif %}

        {% if product.category %}
          <p><strong>Category:</strong> {{ product.category.name }}</p>
        {% endif %}

        {% if product.details.all %}
          <div style="margin:15px 0;">
              <strong>Details:</strong>
              <ul style="padding-left:20px; color:#ccc;">
                  {% for detail in product.details.all %}
                      <li>{{ detail.name }}</li>
                  {% endfor %}
              </ul>
          </div>
        {% endif %}

        {% if product.description %}
          <p style="color:#ddd; font-size:16px; line-height:1.6; margin-bottom:15px;">
            <strong>Description:</strong> {{ product.description }}
          </p>
        {% endif %}

        <p style="font-size:18px; margin-bottom:10px;">
            <strong>Price:</strong>
            <span style="color:#ff6600; font-weight:700;">{{ product.price }} €</span>
        </p>

        <p style="font-size:16px;">
            <strong>Status:</strong>
            {% if product.sold %}
              <span style="color:#ff4d4d; font-weight:600;">SOLD</span>
            {% else %}
              <span style="color:#4caf50; font-weight:600;">Available</span>
            {% endif %}
        </p>

        <!-- Size + Form -->
        <form method="post" action="{% url 'add-to-cart' product.category.id product.id %}" id="cart-form">
            {% csrf_token %}

            <!-- Sizes -->
            <div class="size-selector" style="margin:25px 0;">
                <strong>Choose Size:</strong>
                <div id="size-buttons" style="display:flex; flex-wrap:wrap; gap:12px; margin-top:12px;">
                    {% for size in all_sizes %}
                        {% if size in product.sizes.all %}
                            <button type="button" class="size-btn" data-size="{{ size.id }}"
                                    style="padding:10px 20px;border-radius:10px;border:none;background:#ffcc00;color:#000;font-weight:600;cursor:pointer;">
                                {{ size.name }}
                            </button>
                        {% else %}
                            <button type="button" disabled
                                    style="padding:10px 20px;border-radius:10px;border:none;background:#555;color:#aaa;">
                                {{ size.name }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <input type="hidden" name="size" id="chosen-size">

            <!-- Error messages -->
            <div id="form-errors" style="color:#ff4d4d;font-weight:600;margin-bottom:15px;"></div>

            <!-- Name and Number -->
            {% if product.category.id != 3 %}
            <div style="display:flex; gap:20px; margin-bottom:20px;">
                <div style="flex:1;">
                    <p>Name (optional):</p>
                    <input name="name-id" id="name-id" type="text" class="form-control">
                </div>
                <div style="flex:1;">
                    <p>Number (optional, 1–99):</p>
                    <input name="number-id" id="number-id" type="number" class="form-control" style="width:100px;">
                </div>
            </div>
            {% endif %}



            <!-- Buttons -->
            <div class="product-buttons" style="display:flex; gap:15px; margin-top:20px;">
                <button type="submit" id="cart-btn" class="btn btn-primary"
                        style="background-color:#2C66AB; border-color:black; flex:1;" disabled>
                    Add To Cart
                </button>
                <a href="{% url 'category-products' product.category.id %}" class="btn btn-danger" style="flex:1;width:200px;">
                    Back
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const sizeButtons = document.querySelectorAll(".size-btn");
    const hiddenInput = document.getElementById("chosen-size");
    const cartBtn = document.getElementById("cart-btn");
    const form = document.getElementById("cart-form");
    const errorsDiv = document.getElementById("form-errors");

    // Handle size selection
    sizeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            sizeButtons.forEach(b => {
                b.style.background = "#ffcc00";
                b.style.color = "#000";
            });
            btn.style.background = "linear-gradient(90deg, #ff6600, #ff0000)";
            btn.style.color = "#fff";
            hiddenInput.value = btn.dataset.size;
            cartBtn.disabled = false;
        });
    });

    // Validation
    form.addEventListener("submit", function(e) {
        errorsDiv.innerHTML = "";
        let errors = [];

        const nameVal = document.getElementById("name-id").value.trim();
        const numVal = document.getElementById("number-id").value.trim();

        if (!hiddenInput.value) {
            errors.push("⚠️ Please select a size.");
        }

        if (nameVal !== "" && numVal !== "") {
            if (/\d/.test(nameVal)) {
                errors.push("⚠️ Name cannot contain numbers.");
            }
            const num = parseInt(numVal);
            if (isNaN(num)) {
                errors.push("⚠️ Number must be an integer.");
            } else if (num < 1 || num > 99) {
                errors.push("⚠️ Number must be between 1 and 99.");
            }
        } else if ((nameVal !== "" && numVal === "") || (nameVal === "" && numVal !== "")) {
            errors.push("⚠️ If you fill inputs, fill both of them.");
        }

        if (errors.length > 0) {
            e.preventDefault();
            errorsDiv.innerHTML = errors.join("<br>");
        }
    });
});
</script>
{% endblock %}