{% extends 'shop/base.html' %}

{% block content %}
<div class="product-detail" style="
    max-width: 1000px;
    margin: 40px auto;
    background:#3a3a3a;
    padding:30px;
    border-radius:12px;
    display:flex;
    flex-wrap:wrap;
    gap:30px;">

    <!-- Product photo -->
    <div class="product-photo" style="flex:1; min-width:300px;">
        {% if product.photo %}
          <img src="{{ product.photo.url }}" alt="Product photo" style="width:100%; border-radius:12px;">
        {% else %}
          <div style="width:100%; height:300px; background:#555; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#aaa;">
            No Image
          </div>
        {% endif %}
    </div>

    <!-- Product info -->
    <div class="product-info" style="flex:2; color:#fff;">
        <h1 style="color:#ffcc00; font-size:32px; margin-bottom:15px;">
            {% if product.club %}{{ product.club }}{% endif %}
            {% if product.player %}- {{ product.player }}{% endif %}
            {% if product.name %}{{ product.name }}{% endif %}
            ({{ product.year }})
        </h1>

        {% if product.brand %}
          <p><strong>Brand:</strong> {{ product.brand }}</p>
        {% endif %}

        {% if product.category %}
          <p><strong>Category:</strong> {{ product.category.name }}</p>
        {% endif %}

        {% if product.details.all %}
          <div style="margin:10px 0;">
              <strong>Details:</strong>
              <ul style="padding-left:20px; color:#ccc;">
                  {% for detail in product.details.all %}
                      <li>{{ detail.name }}</li>
                  {% endfor %}
              </ul>
          </div>
        {% endif %}

        {% if product.description %}
          <p><strong>Description:</strong> {{ product.description }}</p>
        {% endif %}

        <p><strong>Price:</strong>
          <span style="color:#ff6600; font-weight:700;">{{ product.price }} â‚¬</span>
        </p>

        <p>
            <strong>Status:</strong>
            {% if product.sold %}
              <span style="color:red; font-weight:600;">SOLD</span>
            {% else %}
              <span style="color:lightgreen; font-weight:600;">Available</span>
            {% endif %}
        </p>

        {# Size selector - only show for categories other than 2 or 3 #}
        {% if product.category.id == 1 and product.sizes.all %}
        <div class="size-selector" style="margin:20px 0;">
            <strong>Choose Size:</strong>
            <div id="size-buttons" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
                {% for size in all_sizes %}
                    {% if size in product.sizes.all %}
                        <button type="button"
                                class="size-btn"
                                data-size="{{ size.id }}"
                                style="padding:8px 16px; border-radius:8px; border:2px solid #000; background:#ffcc00; color:#000; font-weight:600; cursor:pointer;">
                            {{ size.name }}
                        </button>
                    {% else %}
                        <button type="button"
                                disabled
                                style="padding:8px 16px; border-radius:8px; border:2px solid #333; background:#555; color:#aaa; font-weight:600; cursor:not-allowed;">
                            {{ size.name }}
                        </button>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Add to Cart -->
        <form method="post" action="{% url 'add-to-cart' product.category.id product.id %}">
            {% csrf_token %}
            <input type="hidden" name="size" id="chosen-size">
            <div class="product-buttons" style="margin-top:20px;">
                <button type="submit" id="cart-btn" class="btn btn-primary add-to-cart-b"
                        style="background-color:#2C66AB; border-color:black;"
                        {% if product.category.id == 1 or product.sold == True %}disabled{% endif %}>
                    Add To Cart
                </button>
                <a href="{% url 'category-products' product.category.id %}"
                   class="btn btn-primary back-b" style="background-color:#B82609; border-color:black;">
                    Back
                </a>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for size selection -->
{% if product.category.id == 1 %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const sizeButtons = document.querySelectorAll(".size-btn");
    const hiddenInput = document.getElementById("chosen-size");
    const cartBtn = document.getElementById("cart-btn");

    sizeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            sizeButtons.forEach(b => {
                b.style.background = "#ffcc00";
                b.style.color = "#000";
            });

            btn.style.background = "linear-gradient(90deg, #ff6600, #ff0000)";
            btn.style.color = "#fff";

            hiddenInput.value = btn.dataset.size;
            cartBtn.disabled = false;
        });
    });
});
</script>
{% endif %}
{% endblock %}